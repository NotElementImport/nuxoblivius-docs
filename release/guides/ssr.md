# Гайды / Работа с SSR

В этом разделе рассмотрим, как правильно работать с **SSR** (_Server-Side Rendering_) в **Nuxoblivius**, чтобы строить интерфейсы, которые будут одновременно отзывчивыми и безопасными для пользователя.

## Работа с запросами

При использовании `await` внутри `<script setup>` в **Vue** есть две проблемы:

> 1. Выполнение запроса замораживает приложение на время ожидания.

> 2. Отсутствие `await` может привести к утечке данных или некорректному отображению.

Для решения этих проблем предусмотрен хук `useLazySpread()`.
Он работает схожим образом с [`Promise.all`](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Promise/all), но с одним отличием:
на клиенте ожидание (`await`) будет игнорироваться, что делает интерфейс отзывчивее.

```vue {6-10}
<script setup lang="ts">
import { useLazySpread } from "nuxoblivius";
import { Posts } from "@/service/Posts";
import { Comments } from "@/service/Comments";

await useLazySpread([
  Posts.byId.get(postId),
  Comments.byPostId.get(postId),
  () => /* Other async stuff */
]);
</script>
```

Таким образом, на сервере данные будут загружены до рендера, а на клиенте интерфейс не будет "_зависать_".

## Работа с Store

При **SSR** стоит помнить, что серверное приложение (например, на _Node.js_)
запускается один раз и живёт до момента остановки вручную.

Если вы используете `defineStore` или `defineSingleton`, то их экземпляры будут существовать всё время жизни процесса. Это может привести к ситуации, когда данные "_утекают_" между пользователями.

Чтобы избежать этой проблемы, в **Nuxoblivius** предусмотрен хук `deleteDump()`, который очищает состояние до значений по умолчанию.

::: tip Если используете модуль для **Nuxt**
Все вопросы и проблемы уже решены для **Nuxt**, [вот инструкция по настройке](/release/nuxt)
:::

```ts {5}
import { deleteDump } from "nuxoblivius";

// Например, внутри middleware для SSR:
app.use((req, res, next) => {
  deleteDump();
  next();
});
```

Это гарантирует, что каждый новый запрос будет работать с "_чистым_" состоянием.
