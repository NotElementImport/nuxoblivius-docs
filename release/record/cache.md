# Record (Запросы API) / Кэширование <Badge text="^ 1.1.0" style='margin-top: 13px;'/>

_Особенности_: <Badge type="tip" text="Не поддерживает SSR" />

В **Nuxoblivius** предусмотрен встроенный механизм _кэширования запросов_.
Он особенно полезен для **SPA**-приложений, где данные редко обновляются и нет смысла повторно обращаться к _серверу_ при каждом рендере.

---

**Основные особенности работы**:

1. Кэширование доступно только для **GET**-запросов.
2. В кэш попадают только успешные ответы (_код **2xx**_).
3. Повторные запросы с теми же параметрами могут брать данные из кэша, не обращаясь к **API**.

::: tip Почему это может пригодиться?
Такой подход снижает нагрузку на _сервер_ и ускоряет работу приложения, особенно при навигации между страницами или _повторных открытиях компонентов_.
:::

## Быстрая настройка кэширования: <Badge type="tip" text="^1.7.19" />

Для простого и автоматического кэширования в **Nuxoblivius** используется метод `.withAutoCache()`.
Он создаёт ключ кэша на основе _URL_, а также всех _path_ и _query_ параметров.

> Если запрос с теми же параметрами уже выполнялся ранее и был успешен —
> **Record** вернёт сохранённые данные вместо повторного запроса к **API**.

```ts {7}
import { Record } from "nuxoblivius";

const posts = Record.new("/api/posts", [])
  .query({
    page: 1,
  })
  .withAutoCache(); // Автоматическое кэширование

await posts.get(); // Первый запрос — обращение к серверу
await posts.get(); // Второй — данные возвращаются из кэша
```

::: tip Где можно использовать?

⚡ Метод особенно удобен для часто повторяющихся запросов — списков, фильтров, подгрузок, и других данных, которые редко меняются.

:::

## Низкоуровневая настройка кэширования

Изначально **Nuxoblivius** строился вокруг концепции _тегов кэширования_ и ручного управления сохранёнными данными.
Такой подход нужен, когда требуется тонкий контроль над тем, что именно и в каком объёме кэшируется.

### Система тегов

Система тегов описывает стратегию кэширования для конкретных параметров запроса.

> **Доступны два режима**:
>
> - `simply` — сохраняет только последние данные.
> - `full` — сохраняет всю историю изменений.

Создание тега выполняется через метод `.createTag()`.

> **Он принимает два аргумента**:
>
> 1. **Что кэшировать**:
>
> - `path:<name>` — path-параметр запроса.
> - `query:<name>` — query-параметр запроса.
>
> 2. **Как кэшировать**:
>
> - `simply` или `full`.

```ts {5-6}
import { Record } from "nuxoblivius";

const posts = Record.new("/api/posts", []);

posts.createTag("query:page", "simply");
posts.createTag("path:id", "full");
```

### Получение кэшированных данных

В низкоуровневом режиме система _не подставляет кэш автоматически_.
Чтобы получить сохранённые данные, используется взаимствование ([borrowFrom](/release/record/borrow.html)) в связке с методом `.cached()`.

Метод `.cached()` принимает объект с условиями получения данных:

> - `*` — если данные существуют (!== null).
> - `null` — если данные отсутствуют (=== null).
> - `Любое значение` — если данные равны этому значению (== <значение>).

::: code-group

```ts [Получить данные] {7}
import { Record } from "nuxoblivius";

const posts = Record.new("/api/posts", []);

posts.createTag("path:id", "full");

const data = posts.cached({ id: 1 });
```

```ts [Связка с 'borrowFrom'] {9}
import { Record } from "nuxoblivius";

const posts = Record.new("/api/posts", []);

posts.createTag("path:id", "full");
posts.borrowFrom(
  () => true,
  () => [{}]
  (_, { path }) => posts.cached({ id: path.id })
);
```

:::
